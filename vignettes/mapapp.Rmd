---
title: "Introduction to mapapp"
author: "Chris Comiskey"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(shiny)
library(mapapp)
library(ggplot2)
library(dplyr)
```

Welcome to mapapp, a package for creating and introducing interactive heat map confidence intervals (HMCIs) in Shiny. This package provides two functions: `mapit` to create heat maps with the R package ggplot, and `shinyit` to create interactive HMCIs with the R package Shiny. Take a look! 

```{r, fig.height=2, fig.width=2, eval = FALSE}
mapapp::shinyit(CIdata)
```

Shiny and ggplot2 are capable of much more^[Pretty much anything your heart desires in a heat map or web application] than `mapit` and `shinyit` take advantage of. However, mapapp gives you a shortcut if you want a simple version. The hardest part of using mapapp is making sure your data is correctly formatted for `shinyit(...)` before you use it. 

## Formatting for `shinyit(...)

Notice that every setting of the confidence interval (CI) toggle corresponds to two new heat maps---a lower and upper bound. This means `shinyit` needs the point estimate data, and data for all 99 additional CI heat maps. Here's the outline of the required format for the argument `shinyit`:

* You need a list with 100 elements.
* Each element is a data frame.
* The first data frame includes three variables (columns):
    + `x` - horizontal spatial coordinate
    + `y` - vertical spatial coordinate
    + `stat` - heat map statistic for each (`x`,`y`) location
* The remaining i = 1:99 elements are data frames that include two variables: 
    + `lb` - lower bound for the i% CI.
    + `ub` - upper bound for the i% CI

Now we'll go through formatting your data for `shinyit(...)` in stages.

## Create a List

Say we start with a data frame such as `df0`, which comes with mapapp. First, we can create a list with `df0` as its first element.

```{r, eval = FALSE}
head(df0)
fun <- list(df0)
str(fun)
```

## Calculate Confidence Bounds

Next, we need to add all the confidence bounds to the list. I use a loop function to calculate my bounds, but you can do it however you feel comfortable. The basic algorithm structure should be approximately the following:

* Create index i = 1:99
* For an i = 1\% confidence interval, calculate the lower bounds (lb) and upper bounds (ub) for all points in your domain. The bounds should correspond to the coordinates in your original data frame df0.
* Create $2 \times n$ data frame of bounds: (lb, ub). 
* Save this data frame as element i + 1 of `fun`.
* Repeat for i = 2:99, until `fun` is a 100 element list.

In code, this algorithm will look something like this.

```{r, eval = FALSE}
  for(i in 1:99){
    fun[[i+1]] <- data.frame(lb = calculate_lower(i, other_arguments), ub = calculate_upper(i, other_arguments))
  }
```

I wrote `calculate_lower` (`_upper`), but you should insert the method or function you use to calculate the lower (upper) bound for each location. When you're done you'll have something like dataset `list0` that comes with mapapp. 

```{r, eval = FALSE}
head(list0[[1]]) 
head(list0[[2]])
```

## Rename Coordinates and Point Estimates

Almost done! Now select and rename the coordinates and point estimates in the data frame serving as the first element of your list.

```{r}
list0[[1]] <- dplyr::select(list0[[1]], x = px, y = pz, stat = phat)
head(list0[[1]]) 
```

## Create Interactive App

```{r, eval = FALSE}
shinyit(listn)
```
